---
categories: "Lab 3"
title: "Lab 3: Data Visualization with ggplot2"
execute:
  eval: true
format:
  html:
    code-link: true #Supposed to create a link to documentation but its not, for some reason.
   # code-block-bg: true # "lightblue" Does not work well with dark mode.
    code-block-border-left: "#31BAE9"
    code-fold: show #also try true OR false and decide if you like it.
    code-tools: false
    code-copy: true
---

```{r, include=FALSE}
library(openintro)
library(tidyverse)
library(palmerpenguins)
```

## [Introduction]{style="color:#4166f5;"}

In this lab, we introduce a popular package called `ggplot2` used for data visualization. This package is contained within the `tidyverse` package (already installed) so we do not need to install it separately. The term `ggplot` stands for "Grammar of Graphics Plot" which is a system for declaratively creating graphics. It provides a programmatic interface for specifying **what variables to plot**, how they are **displayed**, and general **visual properties**. The package allows users to create a wide variety of high-quality and customizable statistical graphs, making it a valuable tool for data exploration and presentation.

## [Creating your Quarto File]{style="color:#4166f5;"}

Go to posit cloud (<https://posit.cloud>) and open the MATH 144 project. Once you are in, clean up the console, clear the environment, and close any open files.

Next, create your new quarto file as follows:

-   File\>New File \> Quarto document. In the title field use `Introducing ggplot2` then write your name under the `Author` field. Change the output option to `pdf`.

-   Next, save the document as `Lab_2_Explo`. If you did it correctly, the file `Lab_3_Explo.qmd` should appear under the files section.

Delete all text in the document except the YAML header. This leaves a clean document ready for you to write your work.

## [Packages]{style="color:#4166f5;"}

We will need `openintro` and `tidyverse` packages in this lab. Create a level 2 header and call it Packages. Under this, create a new code chunk and load the two packages as follows:

``` toml
library(openintro)
library(tidyverse)
```

Now, render the document to check if it produces a pdf. The output of the package code chunk is not something you want to reproduce in your document. To hide the output, you can use the option `include = FALSE` in the code chunk options. See code below:

```{r}
#| include: false
library(openintro)
library(tidyverse)
```

## [Loading the Data]{style="color:#4166f5;"}

We will need the`duke_forest` dataset contained in the `openintro` package. Load the data as shown below:

```{r}
data(duke_forest)
```

This data were used in lab 2 but you can use the help function `?loan50` to pull the documentation for the data. Note that although you had loaded the data in a previous lab, you loaded it in specific documents. Every time you want to use the data in a new quarto document, you have to load it again.

## [Data Visualization: Numerical Variables]{style="color:#4166f5;"}

### [One Numerical Variable]{style="color:#4166f5;"}

In `Lab 2`, we computed numerical summary statistics using the variable `price` in the `duke_forest` data set. You also learned about ***base R*** and ***Tidyverse*** approaches for finding the statistics. In this lab, we demonstrate how to use the `ggplot2` package to create various visualizations for the `price` variable.

#### [Dot Plot]{style="color:#4166f5;"}

There are three basic steps in creating visualizations using `ggplot2`. The function is called `ggplot()`. The steps include:

-   ***Step 1:*** Add the data argument and set the value to the data set name as shown below then run the code. You will notice a blank canvas.

```{r}
ggplot(data = duke_forest)
```

-   ***Step 2:*** Add variables using the `mapping` argument and the sub function `aes` (aesthetics). This step defines how variables should be mapped on the axes. Since we are dealing with one variable here (price), we will just use the $x-axis$. See code below:

```{r}
ggplot(data = duke_forest, 
       mapping = aes(x = price)
       )
```

-   **Step 3:** Define the visual properties. To define the visual properties, we use the `geom` (short form for geometry) function. In our case, we want to use dotplot and so we **add** the function `geom_dotplot()`. Notice that you must have the parentheses because this is a function that can take more arguments (you will learn more about this) to further define the nature of the dots added.

```{r}
ggplot(data = duke_forest, 
       mapping = aes(x = price)
       ) + 
       geom_dotplot()
```

#### [Histogram]{style="color:#4166f5;"}

Another tool we can use to visualize the distribution of a single numerical variable is a histogram. To create a histogram for the `price` variable, we follow the exact same steps as above but only change the `geom_dotplot` part to `geom_histogram`. See below:

```{r}
ggplot(data=duke_forest, 
       mapping = aes(x = price)
       ) + 
       geom_histogram()
```

#### [Boxplot]{style="color:#4166f5;"}

We can also create a boxplot in the same way but change the geometry to `geom_boxplot`. See below:

```{r}
ggplot(data = duke_forest, 
       mapping = aes(x=price)
       ) + 
       geom_boxplot()
```

***Questions:***

-   By examining the tools created above, how would you describe the distribution of the prices? What is the advantages of dot plot over the histogram? What about the box plot over the histogram?
-   In Lab 2, we computed the mean as one of the numerical summary statistics for the price. Do you think the mean is a good measure of the typical house price in Duke Forest? Why or why not?

Measure of Spread

You can compute various measures of spread using the `summarise` function. For example, to compute the variance for the price variable, you can use the code below:

```{r}
duke_forest |> 
  summarise(var(price))
```

To find the standard deviation, take the square root of variance or use the function below:

```{r}
duke_forest |> 
  summarise(sd(price))
```

To find the first and third quartiles in one step, you can use the `quantile` function as shown below:

```{r}
duke_forest |> 
  summarise(quantile(price, 0.25),
            quantile(price, 0.75))
```

### [Two Numerical Variables]{style="color:#4166f5;"}

#### [Scatter Plots]{style="color:#4166f5;"}

In many cases, we want to assess relationships between two numerical variables. A scatter plot is the most commonly used visualization tool for this. To create a scatter plot, you just need to specify the variable on the $x-axis$ and the one on the $y-axis$. In addition, you will use `geom_point` as the geometry.

Suppose we want to assess the association between `price` and `area`. You can achieve this by using the below. Take a moment to study this code before you run it.

```{r}
ggplot(data = duke_forest, 
       mapping = aes(x = area, y = price)
       ) + 
       geom_point()
```

***Question*** - What pattern do you notice from the above scatter plot? Is this what you expected?

You can add some layer of complexity to the scatter plot to allow you compare three variables. For example, you may want to compare the relationship between price and area by cooling. To do this, you use the color argument as shown below:

```{r}
ggplot(data = duke_forest, 
       mapping = aes(x=area, y = price, color = cooling)
       ) + 
       geom_point()
```

***Question*** - What do you notice in this new scatter plot that you did not notice in the previous one?

## [Data Visualization: Categorical Variables]{style="color:#4166f5;"}

### [Single categorical Variable]{style="color:#4166f5;"}

You can visualize a single categorical variable using tools such as simple bar plots and pie charts.

### [Simple Bar Plot]{style="color:#4166f5;"}

One of the categorical variables in the `duke_forest` data set is `cooling` (central air vs other). Suppose we want to visualize the distribution of the houses by the type of cooling. The variable named `cooling` has values central air or other. We follow the same steps as for creating a dot plot, but change the geometry to `geom_bar()`. See code below:

```{r}
ggplot(data = duke_forest, 
       mapping = aes(x = cooling)
       ) + 
       geom_bar()
```

The bar plot shows that there are slightly fewer houses with central air cooling system that those with "other" types of cooling systems.

In case you want to color the bars by cooling, you can use the `fill` argument inside the `aes` function as shown below the bars using some colors. See below:

```{r}
ggplot(data = duke_forest, 
       mapping = aes(x = cooling, fill=cooling)
       ) + 
       geom_bar()
```

### [Two Categorical Variables]{style="color:#4166f5;"}

We can use stacked bar plots or side-by-side bar plots to visualize two categorical variables. For example, to visualize the relationship between `cooling` and `heating`, we can simply fill the bars by `heating` as shown below:

```{r}
ggplot(data=duke_forest, 
       mapping = aes(x = cooling, fill = heating)
       ) +
       geom_bar()
```

This visualization is not easy to interpret. Using side-by-side (or dodged) bar plots may be a better option. To do this, we just add the `position` argument inside the `geom_bar()` function as shown below:

```{r}
ggplot(data = duke_forest, 
       mapping = aes(x = cooling, fill = heating)
       ) +
       geom_bar(position = "dodge")
```

## [Numerical variable by Category]{style="color:#4166f5;"}

In some cases, you may want to visualize the distribution of a numerical variable by a categorical variable. For example, suppose we want to see the distrivution of price of homes based on type of heating. We can achieve this using `side-by-side` box plots as shown below:

```{r}
ggplot(data = duke_forest, 
       mapping = aes(x = cooling, y = price)
       ) +
       geom_boxplot()
```

Again, you can color the box plots by cooling, or any other categorical variable. See code below that colors the box plots by cooling:

```{r}
ggplot(data = duke_forest, 
       mapping = aes(x = cooling, y = price, fill = cooling)
       ) +
       geom_boxplot()
```

## [Exercises]{style="color:#4166f5;"}

Create a new quarto document and save it as `lab_3_Exe`. Answer the following questions in this document. This lab needs `openintro` and `tidyverse` packages and the `loan50` data set. You can use the code below for this:

``` toml
#| include: false
library(openintro)
library(tidyverse)
data(loan50)
```

1.  **(3 pts)** Create a ***dot plot*** to visualize the distribution of the variable `loan_amount`. Comment on the distribution of this variable.

2.  **(3 pts)** Create a ***box plot*** to visualize the distribution of the variable `interest_rate`. Comment on the distribution of this variable. Are there any outliers?

3.  **(3 pts)** Create a simple ***bar plot*** to visualize the distribution of the variable `loan_purpose`. What can you say based on this plot? (**NOTE:** consider placing the variable on the y-axis instead of the x-axis).

4.  **(3 pts)** Suppose we want to answer the question, "do people with higher `total_income` tend to have higher `loan_amount`?. Create a ***scatter plot*** and use it to answer this question.

5.  **(4 pts)** Create a new ***scatter plot*** that colors the dots on the scatter plot in question 6 above using the categorical variable `has_second_income` (i.e., whether someone has a second income or not). What new insights, if any, do you get from this scatter plot?

6.  **(4 pts)** Create side-by-side box plots to visualize the distribution of `annual_income` based on `homeownership`. What insights can you draw from the plot? Why do you think there is such a pattern?

````{=html}
<!-- Here is the key to the exercises above.

```{r}
data("loan50")
```

Visualize loan_amount using a dot plot.

```{r}
ggplot(data = loan50, 
       mapping = aes(x = loan_amount)
       ) + 
       geom_dotplot()
```
Box plot for interest_rate
```{r}
ggplot(data = loan50, 
       mapping = aes(x = interest_rate)
       ) + 
       geom_boxplot()
```
Bar plot for loan_purpose

```{r}
ggplot(data = loan50, 
       mapping = aes(y = loan_purpose)
       ) + 
       geom_bar()
```

Scatter plot for total_income vs loan_amount
```{r}
ggplot(data = loan50, 
       mapping = aes(x = total_income, y = loan_amount)
       ) + 
       geom_point()
```



Scatter plot colored by has_second_income
```{r}
ggplot(data = loan50, 
       mapping = aes(x = total_income, y = loan_amount, color = has_second_income)
       ) + 
       geom_point()
```
-->
````
